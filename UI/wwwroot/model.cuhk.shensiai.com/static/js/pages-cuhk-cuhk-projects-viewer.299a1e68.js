(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["pages-cuhk-cuhk-projects-viewer"],{"0451":function(e,t,n){"use strict";n.r(t);var r=n("3951"),a=n.n(r);for(var c in r)"default"!==c&&function(e){n.d(t,e,(function(){return r[e]}))}(c);t["default"]=a.a},3142:function(e,t,n){"use strict";var r=n("3b85"),a=n.n(r);a.a},3466:function(e,t,n){"use strict";n.r(t);var r=n("75cd"),a=n("0451");for(var c in a)"default"!==c&&function(e){n.d(t,e,(function(){return a[e]}))}(c);n("3142");var i,o=n("f0c5"),s=Object(o["a"])(a["default"],r["b"],r["c"],!1,null,"51676ac9",null,!1,r["a"],i);t["default"]=s.exports},3951:function(e,t,n){"use strict";(function(e){var r=n("dbce"),a=n("4ea4");n("d81d"),n("d3b7"),n("ac1f"),n("5319"),Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,n("96cf");var c=a(n("1da1")),i=r(n("cb57")),o=n("8196"),s=n("dee7"),d=n("f12c"),u=e.database(),l=(u.command,n("6f60")(i));i.OrbitControls=l;var f={data:function(){return{projectData:null,curscene:null,curtable:null,editScene:{scene:null,camera:null,renderer:null,controls:null,mesh:null,objects:[]},viewportInfo:null}},onLoad:function(e){var t=e.id;this.getDetail(t)},methods:{getDetail:function(e){var t=this;uni.showLoading({mask:!0}),u.collection("cuhk-projects").doc(e).field("scenename,semantic,instance,objectlist,center,create_date").get().then((function(e){var n=e.result.data[0];n&&(t.projectData=n,console.log(t.projectData),t.init())})).catch((function(e){uni.showModal({content:e.message||"请求服务失败",showCancel:!1})})).finally((function(){uni.hideLoading()}))},init:function(){var e=this;return(0,c.default)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$utils.getElementInfo("editScene");case 2:e.viewportInfo=t.sent,n=document.getElementById("editScene"),e.initScene(n,e.editScene),e.loadEditScene();case 6:case"end":return t.stop()}}),t)})))()},initScene:function(e,t){var n=this;return(0,c.default)(regeneratorRuntime.mark((function r(){var a,c,o;return regeneratorRuntime.wrap((function(r){while(1)switch(r.prev=r.next){case 0:a=n.viewportInfo.width/n.viewportInfo.height,t.renderer=new i.WebGLRenderer({antialias:!0}),t.renderer.setPixelRatio(window.devicePixelRatio),t.renderer.setSize(n.viewportInfo.width,n.viewportInfo.height),t.renderer.shadowMap.enabled=!0,e.appendChild(t.renderer.domElement),t.scene=new i.Scene,t.scene.background=new i.Color(10526880),t.camera=new i.PerspectiveCamera(50,a,.1,1e3),t.camera.position.set(4.353,3.818,1.723),t.camera.up=new i.Vector3(0,0,1),c=new i.HemisphereLight(16777215,4473924),c.position.set(0,200,0),t.scene.add(c),o=new i.DirectionalLight(16777215),o.position.set(0,200,100),o.castShadow=!0,o.shadow.camera.top=180,o.shadow.camera.bottom=-100,o.shadow.camera.left=-120,o.shadow.camera.right=120,t.scene.add(o);case 22:case"end":return r.stop()}}),r)})))()},loadEditScene:function(){var e=this;return(0,c.default)(regeneratorRuntime.mark((function t(){var n,r;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.center=new i.Vector3(e.projectData.center.x,e.projectData.center.y,e.projectData.center.z),e.editScene.camera.lookAt(e.center),null==e.editScene.controls&&(e.editScene.controls=new i.OrbitControls(e.editScene.camera,e.editScene.renderer.domElement)),e.editScene.controls.target=e.center,e.editScene.controls.update(),e.editScene.camera.updateMatrixWorld(),e.editScene.camera.updateProjectionMatrix(),n=new o.PLYLoader,n.load("/static/models/scenes/"+e.projectData.scenename+"/"+e.projectData.scenename+".ply",e.projectData.instance,(function(t){t.computeVertexNormals();var n=new i.MeshPhongMaterial({color:16777215,specular:273,shininess:10,vertexColors:i.VertexColors});e.editScene.mesh=new i.Mesh(t,n),e.editScene.mesh.position.set(0,0,0),e.editScene.mesh.scale.multiplyScalar(1),e.editScene.mesh.castShadow=!1,e.editScene.mesh.receiveShadow=!1,e.editScene.scene.add(e.editScene.mesh)})),r=JSON.parse(e.projectData.objectlist),r.map((function(t){e.loadobj(t)})),window.addEventListener("resize",e.onWindowResize),e.updateScene();case 13:case"end":return t.stop()}}),t)})))()},loadobj:function(e){var t=this;return(0,c.default)(regeneratorRuntime.mark((function n(){return regeneratorRuntime.wrap((function(n){while(1)switch(n.prev=n.next){case 0:console.log(e),u.collection("cuhk-objects").where({name:e.name}).get({getOne:!0}).then((function(n){var r=n.result.data;(new d.MTLLoader).load(r.path.replace(".obj",".mtl"),(function(n){n.preload(),(new s.OBJLoader).setMaterials(n).load(r.path,(function(n){n.position.set(e.pos.x,e.pos.y,e.pos.z),n.scale.set(.01*e.scale,.01*e.scale,.01*e.scale),n.rotation.set(e.rotate.x*Math.PI/180,e.rotate.y*Math.PI/180,e.rotate.z*Math.PI/180),t.editScene.scene.add(n)}))}))}));case 2:case"end":return n.stop()}}),n)})))()},onWindowResize:function(){var e=this;return(0,c.default)(regeneratorRuntime.mark((function t(){var n;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$utils.getElementInfo("editScene");case 2:e.viewportInfo=t.sent,n=e.viewportInfo.width/e.viewportInfo.height,e.editScene.camera.aspect=n,e.editScene.camera.updateProjectionMatrix(),e.editScene.renderer.setSize(e.viewportInfo.width,e.viewportInfo.height);case 7:case"end":return t.stop()}}),t)})))()},updateScene:function(){requestAnimationFrame(this.updateScene),this.editScene.renderer.render(this.editScene.scene,this.editScene.camera)}}};t.default=f}).call(this,n("a9ff")["default"])},"3b85":function(e,t,n){var r=n("69af");"string"===typeof r&&(r=[[e.i,r,""]]),r.locals&&(e.exports=r.locals);var a=n("4f06").default;a("7b0980c6",r,!0,{sourceMap:!1,shadowMode:!1})},"69af":function(e,t,n){var r=n("24fb");t=r(!1),t.push([e.i,".scene[data-v-51676ac9]{position:absolute;width:calc(100% - 60px);height:calc(100% - 104px);padding:0;box-sizing:border-box}",""]),e.exports=t},"75cd":function(e,t,n){"use strict";var r;n.d(t,"b",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"a",(function(){return r}));var a=function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("v-uni-view",{staticClass:"uni-container"},[n("v-uni-view",{staticClass:"scene",attrs:{id:"editScene"}})],1)},c=[]},eee7:function(e,t,n){"use strict";var r=n("23e7"),a=n("58a8").start,c=n("c8d2"),i=c("trimStart"),o=i?function(){return a(this)}:"".trimStart;r({target:"String",proto:!0,forced:i},{trimStart:o,trimLeft:o})}}]);